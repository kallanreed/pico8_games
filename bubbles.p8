pico-8 cartridge // http://www.pico-8.com
version 33
__lua__
-- bubble trouble
-- by kallanreed

function _init()
 pal()
 poke(0x5f2e,1)

 board={}

end

function _draw()
 cls()
 bub(64,64,8)
 map(0,0,0,0,16,16)
 
 pal({[0]=129,1,2,3,4,5,6,7,8,9,10,139,12,13,140,132},1)
end

function bub(x,y,col)
 pal(1,col)
 spr(1,x,y)
 pal()
end

-- todo: understand
-- https://www.drdobbs.com/architecture-and-design/fast-bitmap-rotation-and-scaling/184416337
function rspr(s,x,y,a,w,h)
 sw=(w or 1)*8
 sh=(h or 1)*8
 sx=(s%8)*8
 sy=flr(s/8)*8
 x0=flr(0.5*sw)
 y0=flr(0.5*sh)
 a=a/360
 sa=sin(a)
 ca=cos(a)
 for ix=sw*-1,sw+4 do
  for iy=sh*-1,sh+4 do
   dx=ix-x0
   dy=iy-y0
   xx=flr(dx*ca-dy*sa+x0)
   yy=flr(dx*sa+dy*ca+y0)
   if (xx>=0 and xx<sw and yy>=0 and yy<=sh-1) then
    pset(x+ix,y+iy,sget(sx+xx,sy+yy))
   end
  end
 end
end
-->8
-- utils

function to_cell(x,y)
 return flr(x/8),flr(y/8)
end

function to_pxl(x,y)
 return x*8,y*8
end

function clamp(val,max_v)
 return mid(-max_v,val,max_v)
end

__gfx__
000000000066660066cc66ccdecc66cc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000061111606cc66cc6dec66cc6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070061171115cc66cc66de66cc66000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700061711115c66cc66cde6cc66c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770006111111566cc66ccdecc66cc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700611111156cc66cc6dec66cc6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000006111150cc66cc66de66cc66000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000555500c66cc66cde6cc66c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555005555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555445555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555445555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555445555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555445555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555445555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555445555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555445555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555445555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555445555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555445555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555445555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555550000440000555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55550005555445555000555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55505555555445555555055500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55055555555555555555505500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50555555555555555555550500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50555555555555555555550500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50555555555555555555550500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55055555555555555555505500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55505555555555555555055500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55550005555555555000555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555550000000000555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000001010101010000000003020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000003020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000003020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000003020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000003020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000003020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000003020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000003020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000003020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000003020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000003020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000003020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000003020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000001011120000000003020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000002021220000000003020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000003031320000000003020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
